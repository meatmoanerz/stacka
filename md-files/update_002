# Stacka – Ändringar (ny lista, Claude-ready)

Den här filen innehåller **nya** ändringar att implementera. Jag kommer att bifoga tre screenshots i min prompt till Claude för kontext:
- `32877A0C-D64A-4525-9758-75A9AF5C4EF0.jpeg` (Dashboard – KPI + budgetöversikt)
- `85B9C197-123B-480B-AFAB-FE2644C2E159.jpeg` (Dashboard – donut/total + återkommande kort)
- `A4A4B147-3DB7-40F3-8DF8-79BF31AA2A30.jpeg` (Återkommande utgifter – lista och totalsumma)

> Viktigt: Appen är en delad budget-app när två konton är kopplade. Alla “standard”-summeringar ska därför visa **totalt** (jag + partner) om inte användaren aktivt valt annat.

---

## 1) Budget

### 1.1 Toggle: användarnas namn istället för “Min” och “Partner”
**Mål:** I budget-detaljvyn ska togglen visa riktiga namn på användarna.

**Beteende:**
- Lägen i togglen:
  1) **Totalt**
  2) **{Användare 1:s namn}**
  3) **{Användare 2:s namn}**
- Namnen hämtas från user/partner-profiler (fallback: “Du” / “Partner” om namn saknas).

**Klart när:**
- Togglen visar namn i UI (inte “Min” och “partner”).
- Fallback fungerar om något namn saknas.

---

### 1.2 Klick på budget-kategori ska visa underliggande utgifter (drill-down)
**Mål:** När man klickar på en kategori i budgeten ska man kunna se exakt vilka utgifter som summeras i den kategorin.

**Beteende:**
- I budget-detalj (kategoriprogress-listan): tap på en kategori öppnar en lista över utgifter som ingår i summan för den kategorin, filtrerat på:
  - aktuell period (budgetens period)
  - vald vy i togglen (Totalt / user1 / user2)
  - kategori-matchning
- Listan visar minst: namn, datum, belopp, ev. ägare/ikon.

**Klart när:**
- För en vald kategori visas rätt utgifter (summan av listan matchar kategorins “förbrukat” i vyn).
- Filtrering följer togglen (Totalt vs respektive användare).

---

### 1.3 Klick på utgift i drill-down ska öppna “redigera utgift”
**Mål:** Man ska kunna redigera en utgift från budgetens drill-down precis som från Utgifter-sidan.

**Beteende:**
- Tap på en utgift i drill-down öppnar samma edit-vy som när man klickar på en utgift i Utgifter-listan.
- Efter “Spara” uppdateras:
  - drill-down-listan
  - budgetkategori-summan
  - budgetens totalsiffror/progress

**Klart när:**
- Redigering fungerar end-to-end.
- Summor/progress uppdateras direkt efter sparning.

---

## 2) Dashboard

### 2.1 Alla belopp på Dashboard ska visa totalen (delad budget)
**Problem:** Vissa summeringar på dashboarden verkar visa **min del** av utgifter och räknar mot **min del** av budgeten (se screenshots).

**Mål:**
- Dashboardens KPI:er och summeringar ska som default visa:
  - **totala utgifter** mot **total budget** (jag + partner)
  - när konton är kopplade

**Scope (exempel på det som ska vara total):**
- Förbrukat
- Kvar att spendera
- Budgetöversikt (Fasta/Rörliga/Sparande)
- Donut/”Totalt” i fördelningsdelen (om den summerar utgifter)

**Klart när:**
- Alla dessa värden matchar totalen av båda användarnas utgifter i perioden.
- Inga “halverade” eller användarspecifika siffror visas på dashboarden utan att UI tydligt säger det.

---

### 2.2 Ny sektion på Dashboard: “Din del vs Partners del”
**Mål:** Behåll dashboardens totalsiffror, men lägg till en tydlig sektion som visar hur mycket varje person har kvar av sin del av budgeten.

**Beteende:**
- Ny komponent/sektion (förslagsvis under KPI:er eller under Budgetöversikt) som visar:
  - **{User1 namn}: Kvar X kr** (mot sin del av budgeten)
  - **{User2 namn}: Kvar Y kr** (mot sin del av budgeten)
- Om ni använder en fast split (t.ex. 50/50) så används den. Om appen redan har en annan split-logik (t.ex. procent per person) så ska den logiken användas.

**Klart när:**
- Dashboard visar totalen som default + en extra “per person”-översikt.
- Sektionen stämmer med samma period och samma datakällor som budgeten.

---

### 2.3 Sparkvot “Actual” beräknas fel (ska vara sparad andel av lön)
**Problem:** Actual sparkvot visar t.ex. 95% trots att inga utgifter kopplade till sparande är registrerade (enligt din observation). Det indikerar att actual-logiken är fel (eller att den utgår från fel data).

**Mål:**
- “Sparkvot – Actual” ska visa **hur stor del av inkomsten som faktiskt sparats**.

**Rekommenderad definition (implementera konsekvent med din modell):**
- Actual sparande = (inkomst i perioden) – (faktiska utgifter i perioden)
- Actual sparkvot = Actual sparande / inkomst
- Om appen har explicit “sparande”-kategorier som ska räknas annorlunda, måste det vara tydligt och konsekvent.

**Klart när:**
- Actual sparkvot rör sig rimligt baserat på registrerade utgifter och inkomst.
- Om inga utgifter finns och inkomst finns → actual kan bli hög, men ska inte bli “fel” p.g.a. att den råkar räkna bort något dubbelt eller använder bara en persons siffror.

---

## 3) Återkommande utgifter

### 3.1 Återkommande-listan ska visa total kostnad (inte bara min del)
**Problem:** Återkommande utgifter visar bara “min del” per rad, vilket gör att listans rader inte summerar till totalen (se screenshot där total är 8 837 kr/mån men raderna matchar inte).

**Mål:**
- I delad budget ska Återkommande-utgifter visa **totala beloppet per återkommande utgift**.

**Beteende:**
- “Totalt per månad” ska vara summan av listans belopp.
- Varje rad visar full kostnad, inte användarspecifik del (om inte UI har en aktiv filter-toggle).

**Klart när:**
- Summan av alla rader = “Totalt per månad”.
- Siffrorna matchar båda användarnas återkommande utgifter.

---

## Notering om screenshots (för Claude)
De bifogade bilderna visar att vissa vyer verkar räkna “min del” istället för totalen:
- Dashboard KPI “Förbrukat” och Budgetöversikt vs donut/total.
- Återkommande utgifter: total per månad stämmer inte med raderna (indikerar fel summeringskälla eller user-filter).

Claude kan använda detta för att lokalisera var i queries/selects ni filtrerar på user_id/owner och var ni borde slå ihop user+partner när konton är kopplade.
